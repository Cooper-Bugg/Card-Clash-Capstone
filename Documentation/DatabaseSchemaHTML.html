<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Card Clash Database Schema</title>
<style>
  @font-face {
    font-family: "Andika";
    src: url("../public/fonts/Andika/Andika-Regular.ttf") format("truetype");
    font-weight: 400;
    font-style: normal;
  }

  @font-face {
    font-family: "Andika";
    src: url("../public/fonts/Andika/Andika-Bold.ttf") format("truetype");
    font-weight: 700;
    font-style: normal;
  }

  @import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;700;800&display=swap');

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #1D3557;
    color: #F1FAEE;
    font-family: 'Andika', -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 40px 20px;
    min-height: 100vh;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: 2rem;
    font-weight: 800;
    text-align: center;
    margin-bottom: 8px;
    color: #FFC300;
    letter-spacing: -0.5px;
  }

  .subtitle {
    text-align: center;
    color: #F1FAEE;
    opacity: 0.7;
    font-size: 0.8rem;
    margin-bottom: 48px;
  }

  .canvas {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
    max-width: 1100px;
    margin: 0 auto;
    position: relative;
  }

  .table-card {
    background: #F1FAEE;
    border: 1px solid #FFC300;
    border-radius: 10px;
    overflow: hidden;
    position: relative;
  }

  .table-card.highlight {
    border-color: #FFC300;
    box-shadow: 0 0 20px rgba(255, 195, 0, 0.3);
  }

  .table-header {
    background: #14253d;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 2px solid #FFC300;
  }

  .table-header.blue { background: #1D3557; border-bottom-color: #FFC300; }
  .table-header.green { background: #1D3557; border-bottom-color: #FFC300; }
  .table-header.purple { background: #1D3557; border-bottom-color: #FFC300; }
  .table-header.orange { background: #1D3557; border-bottom-color: #FFC300; }
  .table-header.teal { background: #1D3557; border-bottom-color: #FFC300; }
  .table-header.red { background: #E63946; border-bottom-color: #FFC300; }
  .table-header.amber { background: #FFC300; border-bottom-color: #1D3557; }

  .table-icon {
    font-size: 1.1rem;
  }

  .table-name {
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.95rem;
    color: #FFC300;
  }
  
  /* Better contrast for amber header */
  .table-header.amber .table-name {
    color: #1D3557;
  }
  
  .table-header.amber .table-desc {
    color: #1D3557;
    opacity: 0.9;
  }

  .table-desc {
    font-size: 0.65rem;
    color: #F1FAEE;
    opacity: 0.9;
    margin-top: 2px;
  }

  .fields {
    padding: 8px 0;
  }

  .field {
    display: flex;
    align-items: center;
    padding: 5px 16px;
    gap: 8px;
    font-size: 0.75rem;
    border-bottom: 1px solid rgba(29, 53, 87, 0.1);
    transition: background 0.15s;
  }

  .field:last-child { border-bottom: none; }
  .field:hover { background: rgba(29, 53, 87, 0.05); }

  .field-key {
    font-size: 0.6rem;
    padding: 1px 5px;
    border-radius: 3px;
    font-weight: 700;
    flex-shrink: 0;
  }

  .pk { background: #FFC300; color: #1D3557; }
  .fk { background: #1D3557; color: #F1FAEE; }
  .uk { background: #E63946; color: #F1FAEE; }

  .field-name {
    color: #1D3557;
    flex: 1;
  }

  .field-type {
    color: #1D3557;
    opacity: 0.7;
    font-size: 0.65rem;
  }

  .field-note {
    color: #1D3557;
    opacity: 0.6;
    font-size: 0.6rem;
    font-style: italic;
  }

  /* Relationship lines section */
  .relationships {
    max-width: 1100px;
    margin: 36px auto 0;
    background: #F1FAEE;
    border: 2px solid #FFC300;
    border-radius: 10px;
    padding: 24px;
  }

  .relationships h2 {
    font-family: 'Syne', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    color: #1D3557;
    margin-bottom: 16px;
  }

  .rel-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .rel-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 0.75rem;
    padding: 8px 12px;
    background: #1D3557;
    border-radius: 6px;
    border: 1px solid #FFC300;
  }

  .rel-arrow { color: #FFC300; flex-shrink: 0; font-size: 1rem; }
  .rel-text { color: #F1FAEE; line-height: 1.4; }
  .rel-text strong { color: #FFC300; }

  .notes {
    max-width: 1100px;
    margin: 20px auto 0;
    background: #F1FAEE;
    border: 2px solid #FFC300;
    border-radius: 10px;
    padding: 24px;
  }

  .notes h2 {
    font-family: 'Syne', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    color: #1D3557;
    margin-bottom: 16px;
  }

  .notes p {
    font-size: 0.78rem;
    color: #1D3557;
    line-height: 1.7;
    margin-bottom: 10px;
  }

  .notes p:last-child { margin-bottom: 0; }

  .tag {
    display: inline-block;
    padding: 1px 7px;
    border-radius: 4px;
    font-size: 0.65rem;
    font-weight: 700;
    margin-right: 4px;
  }

  .tag-blue { background: #1D3557; color: #F1FAEE; border: 1px solid #1D3557; }
  .tag-green { background: #1D3557; color: #F1FAEE; border: 1px solid #1D3557; }
  .tag-orange { background: #FFC300; color: #1D3557; border: 1px solid #FFC300; }

  .table-card.new-table {
    border-color: #FFC300;
    box-shadow: 0 0 18px rgba(255, 195, 0, 0.3);
  }

  .new-badge {
    display: inline-block;
    font-size: 0.55rem;
    font-weight: 700;
    padding: 1px 6px;
    background: #FFC300;
    color: #1D3557;
    border-radius: 3px;
    margin-left: 6px;
    vertical-align: middle;
    letter-spacing: 0.5px;
  }

  .section-label {
    max-width: 1100px;
    margin: 36px auto 14px;
    font-family: 'Syne', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    color: #FFC300;
    letter-spacing: 1px;
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(255, 195, 0, 0.3);
  }

  /* Add extra vertical spacing when two .canvas groups stack (creates gap between row-2 and row-3) */
  .canvas + .canvas {
    margin-top: 48px;
  }

  code {
    background: #1D3557;
    color: #FFC300;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Andika', monospace;
    font-size: 0.9em;
    border: 1px solid rgba(255, 195, 0, 0.3);
  }
</style>
</head>
<body>

<h1>Card Clash — Database Schema</h1>
<div class="subtitle">MySQL Schema · 8 Tables · Teacher-centric Design</div>

<div class="canvas">

  <!-- Teachers -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">teachers</div>
        <div class="table-desc">Core account table</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">teacher_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key uk">UK</span><span class="field-name">username</span><span class="field-type">VARCHAR(64)</span></div>
      <div class="field"><span class="field-key uk">UK</span><span class="field-name">email</span><span class="field-type">VARCHAR(255)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">password_hash</span><span class="field-type">VARCHAR(255)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">display_name</span><span class="field-type">VARCHAR(128)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">created_at</span><span class="field-type">TIMESTAMP</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">last_login</span><span class="field-type">TIMESTAMP</span></div>
    </div>
  </div>

  <!-- Question Decks -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">decks</div>
        <div class="table-desc">Deck metadata &amp; visibility</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">deck_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">owner_id</span><span class="field-type">→ teachers</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">deck_name</span><span class="field-type">VARCHAR(128)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">description</span><span class="field-type">TEXT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">is_public</span><span class="field-type">TINYINT(1)</span><span class="field-note">0=private</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">subject_tag</span><span class="field-type">VARCHAR(64)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">created_at</span><span class="field-type">TIMESTAMP</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">updated_at</span><span class="field-type">TIMESTAMP</span></div>
    </div>
  </div>

  <!-- Questions -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">questions</div>
        <div class="table-desc">Individual questions per deck</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">question_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">deck_id</span><span class="field-type">→ decks</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">question_text</span><span class="field-type">TEXT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">question_type</span><span class="field-type">ENUM</span><span class="field-note">mc/tf/short</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">correct_answer</span><span class="field-type">TEXT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">answer_options</span><span class="field-type">JSON</span><span class="field-note">for MC</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">points_value</span><span class="field-type">SMALLINT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">time_limit_sec</span><span class="field-type">SMALLINT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">display_order</span><span class="field-type">INT</span></div>
    </div>
  </div>

  <!-- Game Sessions -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">game_sessions</div>
        <div class="table-desc">Each hosted game instance</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">session_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">host_teacher_id</span><span class="field-type">→ teachers</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">deck_id</span><span class="field-type">→ decks</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">session_code</span><span class="field-type">VARCHAR(16)</span><span class="field-note">join PIN</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">status</span><span class="field-type">ENUM</span><span class="field-note">lobby/active/done</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">started_at</span><span class="field-type">TIMESTAMP</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">ended_at</span><span class="field-type">TIMESTAMP</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">player_count</span><span class="field-type">SMALLINT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">rounds_played</span><span class="field-type">SMALLINT</span><span class="field-note">total rounds completed</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">average_accuracy</span><span class="field-type">DECIMAL(5,2)</span><span class="field-note">class average %</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">average_response_time</span><span class="field-type">DECIMAL(6,2)</span><span class="field-note">class avg seconds</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">game_log_json</span><span class="field-type">JSON</span><span class="field-note">complete Photon log</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">ai_summary_text</span><span class="field-type">TEXT</span><span class="field-note">AI-generated insights (3 paragraphs)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">session_config</span><span class="field-type">JSON</span><span class="field-note">game settings</span></div>
    </div>
  </div>

  <!-- Session Results -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">session_results</div>
        <div class="table-desc">Per-player, per-question data</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">result_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">session_id</span><span class="field-type">→ game_sessions</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">question_id</span><span class="field-type">→ questions</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">player_name</span><span class="field-type">VARCHAR(64)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">player_token</span><span class="field-type">VARCHAR(64)</span><span class="field-note">anon ID</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">answer_given</span><span class="field-type">TEXT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">is_correct</span><span class="field-type">TINYINT(1)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">points_earned</span><span class="field-type">SMALLINT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">response_time_ms</span><span class="field-type">INT</span></div>
    </div>
  </div>

  <!-- Deck Shares / Public Access -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">deck_saves</div>
        <div class="table-desc">Teachers saving public decks</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">save_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">teacher_id</span><span class="field-type">→ teachers</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">deck_id</span><span class="field-type">→ decks</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">saved_at</span><span class="field-type">TIMESTAMP</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">is_cloned</span><span class="field-type">TINYINT(1)</span><span class="field-note">own copy?</span></div>
    </div>
  </div>

</div>

<div class="canvas">

  <!-- Session Summaries -->
  <div class="table-card">
    <div class="table-header blue">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">session_summaries</div>
        <div class="table-desc">Cached per-player stats, computed at session end</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">summary_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">session_id</span><span class="field-type">→ game_sessions</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">player_name</span><span class="field-type">VARCHAR(64)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">player_token</span><span class="field-type">VARCHAR(64)</span><span class="field-note">anon ID</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">final_score</span><span class="field-type">INT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">rank</span><span class="field-type">SMALLINT</span><span class="field-note">leaderboard pos</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">accuracy_pct</span><span class="field-type">DECIMAL(5,2)</span><span class="field-note">correct / total</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">avg_response_ms</span><span class="field-type">INT</span><span class="field-note">mean resp time</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">fastest_response_ms</span><span class="field-type">INT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">longest_streak</span><span class="field-type">SMALLINT</span><span class="field-note">consec. correct</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">questions_answered</span><span class="field-type">SMALLINT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">questions_correct</span><span class="field-type">SMALLINT</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">computed_at</span><span class="field-type">TIMESTAMP</span></div>
    </div>
  </div>

  <!-- Question Metrics -->
  <div class="table-card">
    <div class="table-header red">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">question_metrics</div>
        <div class="table-desc">Rolling stats per question across all sessions</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">metric_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">question_id</span><span class="field-type">→ questions</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">times_seen</span><span class="field-type">INT UNSIGNED</span><span class="field-note">total attempts</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">times_correct</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">difficulty_index</span><span class="field-type">DECIMAL(5,2)</span><span class="field-note">% wrong (0–100)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">avg_response_ms</span><span class="field-type">INT</span><span class="field-note">avg time to answer</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">answer_dist</span><span class="field-type">JSON</span><span class="field-note">MC choice tallies</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">sessions_used_in</span><span class="field-type">INT UNSIGNED</span><span class="field-note">session count</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">last_updated</span><span class="field-type">TIMESTAMP</span></div>
    </div>
  </div>

  <!-- Deck Metrics -->
  <div class="table-card">
    <div class="table-header red">
      <span class="table-icon"></span>
      <div>
        <div class="table-name">deck_metrics</div>
        <div class="table-desc">Aggregate stats for a whole deck</div>
      </div>
    </div>
    <div class="fields">
      <div class="field"><span class="field-key pk">PK</span><span class="field-name">bmetric_id</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-key fk">FK</span><span class="field-name">deck_id</span><span class="field-type">→ decks</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">total_sessions</span><span class="field-type">INT UNSIGNED</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">total_players</span><span class="field-type">INT UNSIGNED</span><span class="field-note">all-time</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">avg_accuracy_pct</span><span class="field-type">DECIMAL(5,2)</span><span class="field-note">across all sessions</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">avg_session_score</span><span class="field-type">DECIMAL(8,2)</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">hardest_question_id</span><span class="field-type">INT UNSIGNED</span><span class="field-note">lowest acc. Q</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">easiest_question_id</span><span class="field-type">INT UNSIGNED</span><span class="field-note">highest acc. Q</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">save_count</span><span class="field-type">INT UNSIGNED</span><span class="field-note">bookmarks by others</span></div>
      <div class="field"><span class="field-name" style="padding-left:38px">last_updated</span><span class="field-type">TIMESTAMP</span></div>
    </div>
  </div>

</div>
<div class="relationships">
  <h2>Relationships</h2>
  <div class="rel-grid">
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>teachers</strong> (1) → (many) <strong>decks</strong> — a teacher owns multiple decks</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>decks</strong> (1) → (many) <strong>questions</strong> — each deck holds many questions</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>teachers</strong> (1) → (many) <strong>game_sessions</strong> — a teacher hosts many sessions</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>decks</strong> (1) → (many) <strong>game_sessions</strong> — a deck can be used in many sessions</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>game_sessions</strong> (1) → (many) <strong>session_results</strong> — raw per-question, per-player data</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>teachers ↔ decks</strong> via <strong>deck_saves</strong> — many-to-many for public deck access</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>game_sessions</strong> (1) → (many) <strong>session_summaries</strong> — one summary row per player, written when session ends</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>questions</strong> (1) → (1) <strong>question_metrics</strong> — one rolling-stats row per question, updated after every session</span></div>
    <div class="rel-item"><span class="rel-arrow">→</span><span class="rel-text"><strong>decks</strong> (1) → (1) <strong>deck_metrics</strong> — aggregate health stats per deck, updated after every session</span></div>
  </div>
</div>

<!-- Design Notes -->
<div class="notes">
  <h2>Design Notes</h2>
  <p><span class="tag tag-green">Public Decks</span> The <code>is_public</code> flag on <code>decks</code> is the core toggle. Your server queries <code>WHERE is_public = 1</code> to show the shared library. The <code>deck_saves</code> table then lets teachers bookmark public decks for quick access — or if <code>is_cloned = 1</code>, it signals the teacher made their own editable copy (a new row in <code>decks</code> owned by them, pointing to the same source questions or duplicated ones).</p>
  <p><span class="tag tag-blue">Passwords</span> Store only the <em>hash</em> of the password (bcrypt recommended). Never the plaintext.</p>
  <p><span class="tag tag-blue">Session Results</span> Players in this game are likely students who don't have accounts, so <code>session_results</code> identifies them by a display name and an anonymous session token rather than a foreign key to an accounts table. If you later add student accounts, you can add an optional FK column.</p>
  <p><span class="tag tag-blue">JSON Columns</span> <code>answer_options</code> (for multiple-choice arrays) and <code>session_config</code> (for per-session settings like time limits or randomization) are stored as JSON. MySQL 5.7+ handles this natively. This keeps the schema flexible without extra tables for every possible game setting.</p>
  <p><span class="tag tag-green">Cloning Decks</span> When a teacher wants to edit a public deck they've saved, you'd duplicate the <code>decks</code> row and its child <code>questions</code> rows with the new teacher as <code>owner_id</code>. This keeps the original intact for other users.</p>
  <p><span class="tag tag-orange">session_summaries</span> These rows are written once — when the host ends the session — by a server-side process that aggregates <code>session_results</code>. Since the raw data is still in <code>session_results</code>, you can always recompute them if your formulas change. The <code>computed_at</code> timestamp lets you detect stale summaries.</p>
  <p><span class="tag tag-orange">question_metrics</span> Rather than inserting a new row after every session, these should be upserted (INSERT … ON DUPLICATE KEY UPDATE in MySQL) so each question always has exactly one metrics row. The <code>difficulty_index</code> can be derived as <code>(times_seen - times_correct) / times_seen * 100</code>, but storing it directly makes filtering fast — e.g. "show me all questions harder than 70%". The <code>answer_dist</code> JSON column tallies how many players chose each MC option, which is what lets teachers spot misconception patterns.</p>
  <p><span class="tag tag-orange">deck_metrics</span> Stores the <code>hardest_question_id</code> and <code>easiest_question_id</code> as FKs back to <code>questions</code> so you can surface these in the teacher's deck overview without a costly subquery. The <code>save_count</code> mirrors the count of rows in <code>deck_saves</code> for that deck — useful as social proof in the public deck browser without a JOIN.</p>
  <p><span class="tag tag-blue">Naming Conventions</span> <strong>Database uses snake_case</strong> (session_id, teacher_id, deck_id) while <strong>code/README uses camelCase</strong> (sessionID, teacherID, deckID). <strong>Standardized terminology: "deck"</strong> — both UI/code AND database now use "deck" (not "bank"). The database table is <code>decks</code> and primary key is <code>deck_id</code>. When converting between layers, map: <code>deckID → deck_id</code>, <code>sessionID → session_id</code>, <code>teacherID → teacher_id/host_teacher_id</code>.</p>
  <p><span class="tag tag-green">Game Log & AI Summary</span> The <code>game_log_json</code> field stores the complete Photon event log from Unity (all player actions, timestamps, answer submissions). The <code>ai_summary_text</code> field contains 3 AI-generated paragraphs (can be split on newlines) that analyze class performance — this is what displays in the session report view. Both fields are populated when the session ends.</p>
</div>

</body>
</html>
